# 金钱卦应用 - 占卜历史功能

## 功能概述

为金钱卦应用添加了完整的占卜历史功能，包括占卜记录的增删改查、搜索和备注功能。

## 新增功能

### 1. 占卜历史记录
- **保存占卜记录**：每次占卜后可以保存问题、卦象和备注
- **查看历史记录**：以列表形式展示所有历史占卜记录
- **记录详情**：点击记录可查看完整的卦象解释和备注
- **编辑功能**：可以修改占卜问题和备注内容

### 2. 数据管理
- **搜索功能**：根据问题或备注内容搜索历史记录
- **删除记录**：支持单个记录删除和批量清空
- **数据持久化**：使用 SharedPreferences 本地存储，最多保存100条记录
- **自动排序**：按时间倒序显示，最新记录在前

### 3. 用户界面
- **历史页面**：专门的历史记录管理页面
- **详情页面**：完整的记录详情展示页面
- **添加页面**：手动添加占卜记录的页面
- **搜索界面**：实时搜索功能

## 技术实现

### 核心文件结构
```
lib/
├── models/
│   └── divination_record.dart          # 占卜记录数据模型
├── services/
│   └── divination_storage_service.dart # 数据存储服务
├── pages/
│   ├── history_page.dart               # 历史记录列表页面
│   ├── record_detail_page.dart         # 记录详情页面
│   ├── add_record_page.dart            # 添加记录页面
│   ├── home_page.dart                  # 主页面（已修改）
│   └── result_page.dart                # 结果页面（已修改）
└── widgets/
    └── yin_yang_switch.dart            # 阴阳爻开关组件（已修改）
```

### 数据模型
```dart
class DivinationRecord {
  final String id;                // 唯一标识
  final String question;          // 占卜问题
  final String lines;             // 六爻线条（二进制字符串）
  final Hexagram hexagram;        // 对应的卦象
  final DateTime timestamp;       // 占卜时间
  final String? notes;            // 备注信息
}
```

### 存储服务
- 使用 `SharedPreferences` 进行本地数据持久化
- 支持 JSON 序列化和反序列化
- 提供完整的 CRUD 操作接口
- 自动限制记录数量（最多100条）

## 用户操作流程

### 保存占卜记录
1. 在结果页面点击保存按钮
2. 输入占卜问题和备注（可选）
3. 确认保存，记录自动添加到历史列表

### 查看历史记录
1. 在主页面点击历史按钮
2. 浏览所有历史记录列表
3. 使用搜索框查找特定记录
4. 点击记录查看详细信息

### 管理记录
1. 在详情页面可以编辑问题和备注
2. 通过菜单删除单个记录
3. 在历史页面可以清空所有记录

## 界面特色

### 设计风格
- 保持与原应用一致的暗色主题
- 使用金色（#FFD700）作为主要强调色
- 卡片式布局，清晰易读

### 交互体验
- 下拉刷新历史记录
- 实时搜索过滤
- 确认对话框防止误操作
- 加载状态指示器

### 响应式设计
- 适配不同屏幕尺寸
- 合理的间距和字体大小
- 流畅的动画过渡效果

## 数据安全

### 本地存储
- 数据仅存储在用户设备本地
- 不涉及网络传输或云端存储
- 用户完全控制自己的数据

### 错误处理
- 完善的异常捕获和处理
- 数据解析失败时的降级处理
- 用户友好的错误提示

## 扩展性

### 未来可扩展功能
- 导出历史记录到文件
- 数据备份和恢复
- 统计分析功能
- 分类标签管理
- 云端同步（可选）

### 代码架构
- 模块化设计，易于维护
- 清晰的职责分离
- 可复用的组件设计

## 总结

占卜历史功能为金钱卦应用增加了重要的数据管理能力，让用户可以：
- 记录和回顾自己的占卜历程
- 通过备注功能记录当时的想法和后续验证
- 方便地查找和管理历史记录
- 获得更好的用户体验

该功能完全集成到现有应用中，保持了一致的设计风格和用户体验，为用户提供了完整的占卜记录管理解决方案。